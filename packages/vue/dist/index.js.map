{"version":3,"file":"index.js","sources":["../src/client.ts","../src/useUsermaven.ts","../src/usePageView.ts","../src/plugin.ts"],"sourcesContent":["import { UsermavenClient, usermavenClient, UsermavenOptions } from \"@usermaven/sdk-js\";\n\nfunction createClient(params: UsermavenOptions): UsermavenClient {\n  return usermavenClient(params)\n}\n\nexport default createClient","import { inject } from '@vue/runtime-core'\nimport { UsermavenClient } from '@usermaven/sdk-js'\n\nconst USERMAVEN_INJECTION_KEY = 'usermaven'\n\nexport default function useUsermaven() {\n  const usermaven = inject<UsermavenClient>(USERMAVEN_INJECTION_KEY)\n  \n  if (!usermaven) {\n    throw new Error('Usermaven instance not found. Make sure to use UsermavenPlugin.')\n  }\n\n  return usermaven\n}\n","import { ref, onMounted, onUnmounted, watch } from '@vue/runtime-core'\nimport useUsermaven from './useUsermaven'\nimport { EventPayload, UsermavenClient } from '@usermaven/sdk-js'\n\n// Composable to track URL changes\nfunction useUrlChange() {\n  const url = ref(window.location.href)\n  const lastUrl = ref(window.location.href)\n  const originalPushState = ref<typeof window.history.pushState>()\n  const originalReplaceState = ref<typeof window.history.replaceState>()\n\n  const handleUrlChange = () => {\n    const currentUrl = window.location.href\n    if (currentUrl !== lastUrl.value) {\n      lastUrl.value = currentUrl\n      url.value = currentUrl\n    }\n  }\n\n  onMounted(() => {\n    window.addEventListener('popstate', handleUrlChange)\n\n    // Store original history methods\n    originalPushState.value = window.history.pushState\n    originalReplaceState.value = window.history.replaceState\n\n    // Override history methods\n    window.history.pushState = function (...args: any[]) {\n      if (originalPushState.value) {\n        originalPushState.value.apply(window.history, args as any)\n      }\n      handleUrlChange()\n    }\n\n    window.history.replaceState = function (...args: any[]) {\n      if (originalReplaceState.value) {\n        originalReplaceState.value.apply(window.history, args as any)\n      }\n      handleUrlChange()\n    }\n  })\n\n  onUnmounted(() => {\n    window.removeEventListener('popstate', handleUrlChange)\n    if (originalPushState.value && originalReplaceState.value) {\n      window.history.pushState = originalPushState.value\n      window.history.replaceState = originalReplaceState.value\n    }\n  })\n\n  return url\n}\n\n// usePageView composable\nexport default function usePageView(opts: {\n  before?: (usermaven: UsermavenClient) => void\n  typeName?: string\n  payload?: EventPayload\n} = {}): UsermavenClient {\n  const url = useUrlChange()\n  const usermaven = useUsermaven()\n  const lastTrackedUrl = ref('')\n\n  const trackPageView = () => {\n    if (url.value !== lastTrackedUrl.value) {\n      if (opts.before) {\n        opts.before(usermaven)\n      }\n      usermaven.track(opts?.typeName || 'pageview', {\n        ...opts.payload,\n        url: window.location.href,\n        path: window.location.pathname,\n        referrer: document.referrer,\n        title: document.title\n      })\n      lastTrackedUrl.value = url.value\n    }\n  }\n\n  watch(url, () => {\n    trackPageView()\n  })\n\n  onMounted(() => {\n    trackPageView()\n  })\n\n  return usermaven\n}\n","import { App } from '@vue/runtime-core'\nimport createClient from './client'\nimport { UsermavenOptions } from \"@usermaven/sdk-js\"\n\nconst USERMAVEN_INJECTION_KEY = 'usermaven'\n\nexport const UsermavenPlugin = {\n  install: (app: App, options: UsermavenOptions) => {\n    console.log('UsermavenPlugin installed', options)\n    const client = createClient(options)\n    app.config.globalProperties.$usermaven = client\n    app.provide(USERMAVEN_INJECTION_KEY, client)\n  }\n}\n"],"names":["usermavenClient","USERMAVEN_INJECTION_KEY","inject","ref","onMounted","onUnmounted","watch"],"mappings":"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"}